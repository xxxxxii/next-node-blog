function o(e,t={},s){for(const i in e){const h=e[i],r=s?`${s}:${i}`:i;"object"==typeof h&&null!==h?o(h,t,r):"function"==typeof h&&(t[r]=h)}return t}const e={run:o=>o()},t=void 0!==console.createTask?console.createTask:()=>e;function s(o,e){const s=e.shift(),i=t(s);return o.reduce(((o,t)=>o.then((()=>i.run((()=>t(...e)))))),Promise.resolve())}function i(o,e){const s=e.shift(),i=t(s);return Promise.all(o.map((o=>i.run((()=>o(...e))))))}function h(o,e){for(const t of[...o])t(e)}class r{constructor(){this._hooks={},this._before=void 0,this._after=void 0,this._deprecatedMessages=void 0,this._deprecatedHooks={},this.hook=this.hook.bind(this),this.callHook=this.callHook.bind(this),this.callHookWith=this.callHookWith.bind(this)}hook(o,e,t={}){if(!o||"function"!=typeof e)return()=>{};const s=o;let i;for(;this._deprecatedHooks[o];)i=this._deprecatedHooks[o],o=i.to;if(i&&!t.allowDeprecated){let o=i.message;o||(o=`${s} hook has been deprecated`+(i.to?`, please use ${i.to}`:"")),this._deprecatedMessages||(this._deprecatedMessages=new Set),this._deprecatedMessages.has(o)||this._deprecatedMessages.add(o)}if(!e.name)try{Object.defineProperty(e,"name",{get:()=>"_"+o.replace(/\W+/g,"_")+"_hook_cb",configurable:!0})}catch{}return this._hooks[o]=this._hooks[o]||[],this._hooks[o].push(e),()=>{e&&(this.removeHook(o,e),e=void 0)}}hookOnce(o,e){let t,s=(...o)=>("function"==typeof t&&t(),t=void 0,s=void 0,e(...o));return t=this.hook(o,s),t}removeHook(o,e){if(this._hooks[o]){const t=this._hooks[o].indexOf(e);-1!==t&&this._hooks[o].splice(t,1),0===this._hooks[o].length&&delete this._hooks[o]}}deprecateHook(o,e){this._deprecatedHooks[o]="string"==typeof e?{to:e}:e;const t=this._hooks[o]||[];delete this._hooks[o];for(const s of t)this.hook(o,s)}deprecateHooks(o){Object.assign(this._deprecatedHooks,o);for(const e in o)this.deprecateHook(e,o[e])}addHooks(e){const t=o(e),s=Object.keys(t).map((o=>this.hook(o,t[o])));return()=>{for(const o of s.splice(0,s.length))o()}}removeHooks(e){const t=o(e);for(const o in t)this.removeHook(o,t[o])}removeAllHooks(){for(const o in this._hooks)delete this._hooks[o]}callHook(o,...e){return e.unshift(o),this.callHookWith(s,o,...e)}callHookParallel(o,...e){return e.unshift(o),this.callHookWith(i,o,...e)}callHookWith(o,e,...t){const s=this._before||this._after?{name:e,args:t,context:{}}:void 0;this._before&&h(this._before,s);const i=o(e in this._hooks?[...this._hooks[e]]:[],t);return i instanceof Promise?i.finally((()=>{this._after&&s&&h(this._after,s)})):(this._after&&s&&h(this._after,s),i)}beforeEach(o){return this._before=this._before||[],this._before.push(o),()=>{if(void 0!==this._before){const e=this._before.indexOf(o);-1!==e&&this._before.splice(e,1)}}}afterEach(o){return this._after=this._after||[],this._after.push(o),()=>{if(void 0!==this._after){const e=this._after.indexOf(o);-1!==e&&this._after.splice(e,1)}}}}function n(){return new r}export{n as c};
