System.register([],(function(t,e){"use strict";return{execute:function(){t("r",(function(t,e){e=e||{},t.core.ruler.before("linkify","image_figures",(function(s){let c=1;for(let o=1,a=s.tokens.length;o<a-1;++o){const l=s.tokens[o];if("inline"!==l.type)continue;if(!l.children||1!==l.children.length&&3!==l.children.length)continue;if(1===l.children.length&&"image"!==l.children[0].type)continue;if(3===l.children.length){const[t,e,n]=l.children;if("link_open"!==t.type||"image"!==e.type||"link_close"!==n.type)continue}if(0!==o&&"paragraph_open"!==s.tokens[o-1].type)continue;if(o!==a-1&&"paragraph_close"!==s.tokens[o+1].type)continue;const f=s.tokens[o-1];let h;if(f.type="figure_open",f.tag="figure",s.tokens[o+1].type="figure_close",s.tokens[o+1].tag="figure",e.dataType&&s.tokens[o-1].attrPush(["data-type","image"]),e.link&&1===l.children.length){[h]=l.children;const t=new s.Token("link_open","a",1);t.attrPush(["href",h.attrGet("src")]),l.children.unshift(t),l.children.push(new s.Token("link_close","a",-1))}if(h=1===l.children.length?l.children[0]:l.children[1],e.figcaption){const i=r(e.figcaption,h);if(i){const[e]=t.parseInline(i,s.env);l.children.push(new s.Token("figcaption_open","figcaption",1)),l.children.push(...e.children),l.children.push(new s.Token("figcaption_close","figcaption",-1)),h.attrs&&(h.attrs=n(h.attrs,"title"))}}if(e.copyAttrs&&h.attrs){const t=!0===e.copyAttrs?"":e.copyAttrs;f.attrs=h.attrs.filter((([e])=>e.match(t))).map((t=>Array.from(t)))}if(e.tabindex&&(s.tokens[o-1].attrPush(["tabindex",c]),c++),e.lazy&&(h.attrs.some((([t])=>"loading"===t))||h.attrs.push(["loading","lazy"])),e.async&&(h.attrs.some((([t])=>"decoding"===t))||h.attrs.push(["decoding","async"])),e.classes&&"string"==typeof e.classes){let t=!1;for(let n=0,i=h.attrs.length;n<i&&!t;n++){const i=h.attrs[n];"class"===i[0]&&(i[1]=`${i[1]} ${e.classes}`,t=!0)}t||h.attrs.push(["class",e.classes])}if(e.removeSrc){const t=h.attrs.find((([t])=>"src"===t));h.attrs.push(["data-src",t[1]]),i(h,"src")}}}))}));const e=new Set([!0,!1,"alt","title"]);function n(t,e){return(Array.isArray(t)?t:[]).filter((([t])=>t!==e))}function i(t,e){t&&t.attrs&&(t.attrs=n(t.attrs,e))}function r(t,n){if(!e.has(t))throw new TypeError(`figcaption must be one of: ${[...e]}.`);if("alt"===t)return n.content;const r=n.attrs.find((([t])=>"title"===t));return Array.isArray(r)&&r[1]?(i(n,"title"),r[1]):void 0}}}}));
